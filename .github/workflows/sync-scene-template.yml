name: Sync

on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * *'  # se puede ajustar para correr diario a medianoche
  pull_request:
    branches:
      - main 

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo-sync repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set git user
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

      - name: Clean combined folder
        run: rm -rf combined

      - name: Clone dcl-sdk7-docs
        run: git clone --depth 1 https://github.com/drkrillo/dcl-sdk7-docs.git temp-docs

      - name: Clone sdk7-scene-template
        run: git clone --depth 1 https://github.com/decentraland/sdk7-scene-template.git temp-scene

      - name: Clone dcl-ai-context
        run: git clone --depth 1 https://github.com/drkrillo/dcl-ai-context.git temp-ai-context

      - name: Sync dcl-sdk7-docs
        run: |
          mkdir -p combined/sdk7-docs
          rsync -av --exclude='.git' temp-docs/ combined/sdk7-docs/

      - name: Sync sdk7-scene-template
        run: |
          mkdir -p combined/scene-template
          rsync -av --exclude='.git' temp-scene/ combined/scene-template/

      - name: Sync dcl-ai-context
        run: |
          mkdir -p combined/dcl-ai-context
          rsync -av --exclude='.git' temp-ai-context/ combined/dcl-ai-context/

      - name: Commit and push changes
        run: |
          git add combined
          git diff --cached --quiet || git commit -m "ðŸ”„ Sync repos into combined/"
          git push origin main
